<link rel="import" href="bower_components/polymer/polymer.html">
<polymer-element name="synth3d-inspector">
    <template>
        
        <link rel="stylesheet" href="style.css">
        <style>
            button
            {
                margin: 5px;
                color : white;
                font-size : 1em;
                text-transform:uppercase;
                border : none;
                background-color : #0080FF;
                box-shadow : 0px 1px 3px rgba(0,0,0,0.5);
                cursor : pointer;
            }
        </style>
        
        <template bind if="{{block == null}}">
            <div class="info">Sélectionnez un bloc pour pouvoir l'éditer</div>
        </template>
        
        <template if="{{block.blockType == 'wave'}}">
            <div id="waveBlock" class="blocEditor">
                <h2>Bloc Oscillateur</h2>
                <div class="info">Ce bloc permet de générer un signal sinusoïdale</div>
                <h3>Type</h3>
                <div>
                    <button class="waveType" on-click={{setOscTypeToSine}}>Sine</button>
                    <button class="waveType" on-click={{setOscTypeToSquare}}>Square</button>
                    <button class="waveType" on-click={{setOscTypeToSawtooth}}>Sawtooth</button>
                    <button class="waveType" on-click={{setOscTypeToTriangle}}>Triangle</button>
                </div>
                <h3>Entrée</h3>
                <div><label>Facteur 3D : </label><input id="factor" type="number" step="0.1" min="0" max="200" value={{block.factor}}></div>
                <h4>Fréquence</h4>
                <div><label>Valeur (Hz) : </label><input id="waveFreq" type="number" step="1" min="0" max="20000" value={{block.audioNode.frequency.value}}></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkFreq" on-click={{setOscFreqToNone}}>None</button>
                <button class="linkFreq" on-click={{setOscFreqToX}}>X</button>
                <button class="linkFreq" on-click={{setOscFreqToY}}>Y</button>
                <button class="linkFreq" on-click={{setOscFreqToZ}}>Z</button>
                </div>
                <h4>Amplitude</h4>
                <div><label>Valeur : </label><input id="waveAmp" type="number" step="0.1" min="0" max="100" value={{block.audioNodeGain.gain.value}}></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkGain" on-click={{setGainToNone}}>None</button>
                <button class="linkGain" on-click={{setGainToX}}>X</button>
                <button class="linkGain" on-click={{setGainToY}}>Y</button>
                <button class="linkGain" on-click={{setGainToZ}}>Z</button>
                </div>
                <h3>Sortie</h3>
                <div layout vertical>
                                <button class="linkBlock" on-click={{link}}>Lier le signal de sortie</button>                   </div>
            </div>
        </template>
        <template if="{{block.blockType == 'adsr'}}">
            <div id="adsrBlock" class="blocEditor">
                <h2>Bloc ADSR</h2>
                <div class="info">Ce bloc permet d'appliquer une enveloppe ADSR à un signal</div>
                <h3>Entrée</h3>
                <div><label for="">Attack : Amplitude</label><input type="number" step="any"></div>
                <div><label for="">Attack : Timing</label><input type="number" step="any"></div>
                <div><label for="">Decay : Amplitude</label><input type="number" step="any"></div>
                <div><label for="">Decay : Timing</label><input type="number" step="any"></div>
                <div><label for="">Sustain : Amplitude</label><input type="number" step="any"></div>
                <div><label for="">Sustain : Timing</label><input type="number" step="any"></div>
                <div><label for="">Release : Timing</label><input type="number" step="any"></div>
                <h3>Sortie</h3>
                <div layout vertical>
                                <button class="linkBlock" on-click={{link}}>Lier le signal de sortie</button>
                   </div>
            </div>
        </template>
        <template if="{{block.blockType == 'midi'}}">
            <div id="midiBlock" class="blocEditor">
                <h2>Bloc MIDI</h2>
                <div class="info">Ce bloc permet de générer un signal MIDI</div>
                <h3>Entrée</h3>
                <div><label>Facteur 3D : </label><input id="factor" type="number" step="0.1" min="0" max="200" value={{block.factor}}></div>
                <h4>Note</h4>
                <div><label for="">Valeur (0-127) : </label><input type="number" step="1" min="0" max="127" value={{block.note.round}}><button class="linkBlock" on-click={{updateFreq}}>Set</button></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkNote" on-click={{setNoteToNone}}>None</button>
                <button class="linkNote" on-click={{setNoteToX}}>X</button>
                <button class="linkNote" on-click={{setNoteToY}}>Y</button>
                <button class="linkNote" on-click={{setNoteToZ}}>Z</button>
                </div>
                <h3>Sortie</h3>
                <div layout vertical>
                                <button class="linkBlock" on-click={{link}}>Lier la fréquence de sortie</button>                   </div>
            </div>
        </template>
        <template if="{{block.blockType == 'delay'}}">
            <div id="delayBlock" class="blocEditor">
                <h2>Bloc Délai</h2>
                <div class="info">Ce bloc permet d'ajouter un délai temporel à un signal</div>
                <h3>Entrée</h3>
                <div><label>Facteur 3D : </label><input id="factor" type="number" step="0.1" min="0" max="200" value={{block.factor}}></div>
                <h4>Délai</h4>
                <div><label for="">Valeur (sec) : </label><input type="number" step="0.1" min="0" max="10" value={{block.audioNode.delayTime.value}}></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkDelay" on-click={{setDelayToNone}}>None</button>
                <button class="linkDelay" on-click={{setDelayToX}}>X</button>
                <button class="linkDelay" on-click={{setDelayToY}}>Y</button>
                <button class="linkDelay" on-click={{setDelayToZ}}>Z</button>
                </div>
                <h4>Gain</h4>
                <div><label for="">Valeur : </label><input type="number" step="0.1" min="0" max="1" value={{block.audioNodeGain.gain.value}}></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkGain" on-click={{setGainToNone}}>None</button>
                <button class="linkGain" on-click={{setGainToX}}>X</button>
                <button class="linkGain" on-click={{setGainToY}}>Y</button>
                <button class="linkGain" on-click={{setGainToZ}}>Z</button>
                </div>
                <h3>Sortie</h3>
                <div layout vertical>
                                <button class="linkBlock" on-click={{link}}>Lier le signal de sortie</button>                   </div>
            </div>
        </template>
        <template if="{{block.blockType == 'sample'}}">
            <div id="sampleBlock" class="blocEditor">
                <h2>Bloc Sample</h2>
                <div class="info">Ce bloc permet de charger et jouer un sample</div>
                <h3>Type</h3>
                <div>
                    <button class="linkBlock" on-click={{loadSampleKickDrum}}>Load Kick Drum</button>
                    <button class="linkBlock" on-click={{loadSampleSnare}}>Load Snare</button>
                    <button class="linkBlock" on-click={{playCurrentSample}}>Play</button>
                </div>
                <h3>Entrée</h3>
                <div><label>Facteur 3D : </label><input id="factor" type="number" step="0.1" min="0" max="200" value={{block.factor}}></div>
                <h4>Gain</h4>
                <div><label>Valeur : </label><input id="waveAmp" type="number" step="0.1" min="0" max="1" value={{block.audioNodeGain.gain.value}}></div>
                <div>
                <label>Lier en 3D : </label>
                <button class="linkGain" on-click={{setGainToNone}}>None</button>
                <button class="linkGain" on-click={{setGainToX}}>X</button>
                <button class="linkGain" on-click={{setGainToY}}>Y</button>
                <button class="linkGain" on-click={{setGainToZ}}>Z</button>
                </div>
                <h3>Sortie</h3>
                <div layout vertical>
                                <button class="linkBlock" on-click={{link}}>Lier le signal de sortie</button>                   </div>
            </div>
        </template>
        <template if="{{block.blockType == 'listener'}}">
            <div id="delayBlock" class="blocEditor">
                <h2>Bloc Listener</h2>
                <div class="info">Ce bloc envoie les signaux d'entrée à la sortie son</div>
                <h3>Entrée</h3>
                <div><label for="">Volume : </label><input type="number" step="0.1" min="0" max="1" value={{block.audioNodeGain.gain.value}}></div>
                <button class="linkGain" on-click={{setGainToNone}}>None</button>
                <button class="linkGain" on-click={{setGainToX}}>X</button>
                <button class="linkGain" on-click={{setGainToY}}>Y</button>
                <button class="linkGain" on-click={{setGainToZ}}>Z</button>
            </div>
        </template>
    </template>
    <script>
        Polymer({
            block : null,
            link : function()
            {
                var blockToLink = this.block;
                window.currentTool.setBlock(null);
                window.currentTool = Tools.linkTool;
                window.currentTool.setType(blockToLink.outType);
                window.currentTool.setBlock(blockToLink);
            },
            updateFreq : function()
            {
                this.block.updateFrequencies();
            },
            setOscTypeToSine : function()
            {
                this.block.audioNode.type = "sine";
            },
            setOscTypeToSquare : function()
            {
                this.block.audioNode.type = "square";
            },
            setOscTypeToSawtooth : function()
            {
                this.block.audioNode.type = "sawtooth";
            },
            setOscTypeToTriangle : function()
            {
                this.block.audioNode.type = "triangle";
            },
            setOscFreqToNone : function()
            {
                if(this.block.xFactor == this.block.audioNode.frequency)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNode.frequency)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNode.frequency)
                    this.block.zFactor = null;
            },
            setOscFreqToX : function()
            {
                this.block.xFactor = this.block.audioNode.frequency;
                if(this.block.yFactor == this.block.audioNode.frequency)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNode.frequency)
                    this.block.zFactor = null;
            },
            setOscFreqToY : function()
            {
                if(this.block.xFactor == this.block.audioNode.frequency)
                    this.block.xFactor = null;
                this.block.yFactor = this.block.audioNode.frequency;
                if(this.block.zFactor == this.block.audioNode.frequency)
                    this.block.zFactor = null;
            },
            setOscFreqToZ : function()
            {
                if(this.block.xFactor == this.block.audioNode.frequency)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNode.frequency)
                    this.block.yFactor = null;
                this.block.zFactor = this.block.audioNode.frequency;
            },
            setGainToNone : function()
            {
                if(this.block.xFactor == this.block.audioNodeGain.gain)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNodeGain.gain)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNodeGain.gain)
                    this.block.zFactor = null;
            },
            setGainToX : function()
            {
                this.block.xFactor = this.block.audioNodeGain.gain;
                if(this.block.yFactor == this.block.audioNodeGain.gain)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNodeGain.gain)
                    this.block.zFactor = null;
            },
            setGainToY : function()
            {
                if(this.block.xFactor == this.block.audioNodeGain.gain)
                    this.block.xFactor = null;
                this.block.yFactor = this.block.audioNodeGain.gain;
                if(this.block.zFactor == this.block.audioNodeGain.gain)
                    this.block.zFactor = null;
            },
            setGainToZ : function()
            {
                if(this.block.xFactor == this.block.audioNodeGain.gain)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNodeGain.gain)
                    this.block.yFactor = null;
                this.block.zFactor = this.block.audioNodeGain.gain;
            },
            setDelayToNone : function()
            {
                if(this.block.xFactor == this.block.audioNode.delayTime)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNode.delayTime)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNode.delayTime)
                    this.block.zFactor = null;
            },
            setDelayToX : function()
            {
                this.block.xFactor = this.block.audioNode.delayTime;
                if(this.block.yFactor == this.block.audioNode.delayTime)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.audioNode.delayTime)
                    this.block.zFactor = null;
            },
            setDelayToY : function()
            {
                if(this.block.xFactor == this.block.audioNode.delayTime)
                    this.block.xFactor = null;
                this.block.yFactor = this.block.audioNode.delayTime;
                if(this.block.zFactor == this.block.audioNode.delayTime)
                    this.block.zFactor = null;
            },
            setDelayToZ : function()
            {
                if(this.block.xFactor == this.block.audioNode.delayTime)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.audioNode.delayTime)
                    this.block.yFactor = null;
                this.block.zFactor = this.block.audioNode.delayTime;
            },
            setNoteToNone : function()
            {
                if(this.block.xFactor == this.block.note)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.note)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.note)
                    this.block.zFactor = null;
            },
            setNoteToX : function()
            {
                this.block.xFactor = this.block.note;
                if(this.block.yFactor == this.block.note)
                    this.block.yFactor = null;
                if(this.block.zFactor == this.block.note)
                    this.block.zFactor = null;
            },
            setNoteToY : function()
            {
                if(this.block.xFactor == this.block.note)
                    this.block.xFactor = null;
                this.block.yFactor = this.block.note;
                if(this.block.zFactor == this.block.note)
                    this.block.zFactor = null;
            },
            setNoteToZ : function()
            {
                if(this.block.xFactor == this.block.note)
                    this.block.xFactor = null;
                if(this.block.yFactor == this.block.note)
                    this.block.yFactor = null;
                this.block.zFactor = this.block.note;
            },
            loadSampleKickDrum : function()
            {
                this.block.loadSample("samples/kickdrum.wav");
            },
            loadSampleSnare : function()
            {
                this.block.loadSample("samples/snare.wav");
            },
            playCurrentSample : function()
            {
                this.block.playSample();
            }
        });
    </script>
</polymer-element>